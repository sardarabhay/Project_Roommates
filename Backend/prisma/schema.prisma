generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Household {
  id         Int      @id @default(autoincrement())
  name       String
  inviteCode String   @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  createdByUserId  Int
  members          User[]
  expenses         Expense[]
  chores           Chore[]
  events           Event[]
  issues           Issue[]
  documents        Document[]
  landlords        Landlord[]
  houseRules       HouseRule[]
  bulletinPosts    BulletinPost[]
  removalRequests  RemovalRequest[]
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String?
  avatarUrl String?
  role      String   @default("member") // admin, member
  fcmToken  String?  // Firebase Cloud Messaging token for push notifications
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  paidExpenses       Expense[]        @relation("PaidByUser")
  createdExpenses    Expense[]        @relation("CreatedByUser")
  owedSplits         ExpenseSplit[]   @relation("OwedByUser")
  assignedChores     Chore[]          @relation("AssignedToUser")
  createdChores      Chore[]          @relation("ChoreCreatedBy")
  createdEvents      Event[]          @relation("CreatedByUser")
  eventRsvps         EventRsvp[]
  reportedIssues     Issue[]          @relation("ReportedByUser")
  uploadedDocs       Document[]       @relation("UploadedByUser")
  bulletinPosts      BulletinPost[]   @relation("PostedByUser")
  removalRequests    RemovalRequest[] @relation("TargetUser")
  requestedRemovals  RemovalRequest[] @relation("RequestedByUser")
  removalVotes       RemovalVote[]
}

model RemovalRequest {
  id          Int      @id @default(autoincrement())
  status      String   @default("pending") // pending, approved, rejected
  reason      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  householdId     Int
  household       Household     @relation(fields: [householdId], references: [id])
  targetUserId    Int
  targetUser      User          @relation("TargetUser", fields: [targetUserId], references: [id])
  requestedByUserId Int
  requestedByUser User          @relation("RequestedByUser", fields: [requestedByUserId], references: [id])
  votes           RemovalVote[]
}

model RemovalVote {
  id        Int      @id @default(autoincrement())
  vote      String   // approve, reject
  createdAt DateTime @default(now())

  // Relations
  removalRequestId Int
  removalRequest   RemovalRequest @relation(fields: [removalRequestId], references: [id], onDelete: Cascade)
  userId           Int
  user             User           @relation(fields: [userId], references: [id])

  @@unique([removalRequestId, userId])
}

model Expense {
  id          Int      @id @default(autoincrement())
  description String
  totalAmount Float
  category    String   @default("other") // groceries, rent, utilities, food, entertainment, transport, household, other
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  paidByUserId    Int
  paidByUser      User           @relation("PaidByUser", fields: [paidByUserId], references: [id])
  createdByUserId Int?
  createdByUser   User?          @relation("CreatedByUser", fields: [createdByUserId], references: [id])
  splits          ExpenseSplit[]
}

model ExpenseSplit {
  id        Int      @id @default(autoincrement())
  amount    Float
  status    String   @default("pending") // pending, settled
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  expenseId     Int
  expense       Expense @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  owedByUserId  Int
  owedByUser    User    @relation("OwedByUser", fields: [owedByUserId], references: [id])

  @@unique([expenseId, owedByUserId])
}

model Chore {
  id               Int       @id @default(autoincrement())
  title            String
  description      String?
  points           Int       @default(0)
  status           String    @default("todo") // todo, in_progress, done
  dueDate          DateTime?
  isRecurring      Boolean   @default(false)
  recurringPattern String?   // daily, weekly, monthly
  isArchived       Boolean   @default(false)
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  assignedToUserId Int?
  assignedToUser   User?     @relation("AssignedToUser", fields: [assignedToUserId], references: [id])
  createdByUserId  Int?
  createdByUser    User?     @relation("ChoreCreatedBy", fields: [createdByUserId], references: [id])
}

model Event {
  id        Int      @id @default(autoincrement())
  title     String
  date      DateTime
  location  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  createdByUserId Int
  createdByUser   User        @relation("CreatedByUser", fields: [createdByUserId], references: [id])
  rsvps           EventRsvp[]
}

model EventRsvp {
  id        Int      @id @default(autoincrement())
  status    String   // going, maybe, not-going
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  eventId Int
  event   Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId  Int
  user    User  @relation(fields: [userId], references: [id])

  @@unique([eventId, userId])
}

model Issue {
  id          Int      @id @default(autoincrement())
  title       String
  description String?
  status      String   @default("Reported") // Reported, In Progress, Resolved
  priority    String   @default("Medium") // Low, Medium, High, Urgent
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  reportedByUserId Int
  reportedByUser   User @relation("ReportedByUser", fields: [reportedByUserId], references: [id])
}

model Document {
  id        Int      @id @default(autoincrement())
  name      String
  fileUrl   String?
  size      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  uploadedByUserId Int
  uploadedByUser   User @relation("UploadedByUser", fields: [uploadedByUserId], references: [id])
}

model Landlord {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String?
  email     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])
}

model HouseRule {
  id        Int      @id @default(autoincrement())
  content   String
  orderNum  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])
}

model BulletinPost {
  id        Int      @id @default(autoincrement())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Household relation
  householdId Int?
  household   Household? @relation(fields: [householdId], references: [id])

  // Relations
  postedByUserId Int
  postedByUser   User @relation("PostedByUser", fields: [postedByUserId], references: [id])
}
